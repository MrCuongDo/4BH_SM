extends layout

block content
    h1= title
    p Trang hiển thị danh sách tất cả Lego

    h3 Thêm sản phẩm
    form(action="") 
        table 
            thead
            tbody
                tr 
                    td
                        input#inputMaSanPham(type="text", placeholder="Mã sản phẩm" , value="")
                        input#inputTenSanPham(type="text", placeholder="tên sản phẩm", value="")
                        input#inputTheme(type="text", placeholder="Theme", value='')
                        input#inputPrice(type="text", placeholder="Giá", value='')
                        input#themBtn(type="button", value="Them")
    
    h3 Danh sách Lego
    table#ds_legolist.table.table-hover.table-striped
        thead 
            tr
                th  STT 
                th  Mã Sản Phẩm 
                th  Tên Sản Phẩm 
                th  Theme 
                th  Price
                th  Thao tác
        tbody#table_body
            


    script(type="text/javascript").

        $(document).ready(function() {

            $('#ds_legolist').DataTable({
                ajax: {
                    url: '/sanpham/dsSanPham',
                    type: 'POST',
                    dataSrc: '',
                },
                columnDefs: [
                    {'width': '10%', 'targets': 0},
                    {'width': '15%', 'targets': 1},
                    {'width': '15%', 'targets': 2},
                    {'width': '25%', 'targets': 3},
                    {'width': '25%', 'targets': 4},
                    {'width': '25%', 'targets': 5},
                ],
                columns: [
                    {'data': 'stt', 'orderable': false}, // tắt chức năng order cho cột STT},
                    {'data': 'maSanPham'},
                    {'data': 'tenSanPham'},
                    {'data': 'theme'},
                    {'data': 'price'},
                    { 'render': function(data, type, row) {
                        return `
                            <button class='btn btn-primary btn-sm' onclick='clickXoa(${row.id})' >Xoa</button>
                        `;
                        },
                    }
                ],
            });
        } );

        $('#themBtn').on('click', function(e) {
            let maSanPham = $('#inputMaSanPham').val()
            let tenSanPham = $('#inputTenSanPham').val()
            let theme = $('#inputTheme').val()
            let price = $('#inputPrice').val()

            if(!maSanPham || !tenSanPham || !theme || !price) {
                alert('Vui lòng nhập đầy đủ thông tin');
            } else {
                $.post('/sanpham/themSanPham', {
                    maSanPham, 
                    tenSanPham, 
                    theme, 
                    price
                },'json').done(function(res){
                    alert('Thêm sản phẩm thành công');
                    $('#ds_legolist').DataTable().ajax.reload();
                })
            }
        })

        function clickXoa(id) {
            if(id) {
                $.post('/sanpham/xoaSanPham', {
                    id
                },'json').done(function(res){
                    alert('Xóa sản phẩm thành công');
                    $('#ds_legolist').DataTable().ajax.reload();
                })
            } else {
                alert('Không có ID');
            }
        }
